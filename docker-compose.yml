services:
  gluetun:
    image: qmcgaw/gluetun
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    environment:
      # Configure your VPN provider - see https://github.com/qdm12/gluetun-wiki
      - VPN_SERVICE_PROVIDER=protonvpn  # or: mullvad, nordvpn, expressvpn, etc.
      - VPN_TYPE=wireguard              # or: openvpn
      # Provider-specific settings (example for ProtonVPN WireGuard)
      - WIREGUARD_PRIVATE_KEY=${WIREGUARD_PRIVATE_KEY}
      - SERVER_COUNTRIES=${SERVER_COUNTRIES:-Switzerland}
    ports:
      - "${WEBUI_PORT:-8080}:8080"  # Rustatio Web UI
    restart: always

  rustatio:
    image: ghcr.io/testycro/rustatio:latest
    container_name: rustatio
    environment:
      - PORT=8080
      - RUST_LOG=${RUST_LOG:-trace}
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      # Optional authentication for your server (Recommended if exposing on internet)
      # - AUTH_TOKEN=${AUTH_TOKEN:-CHANGE_ME}
      # Optional: Watch folder configuration (auto-detected if volume is mounted)
      - WATCH_AUTO_START=true  # Set to true to auto-start faking new torrents

      - CLIENT_DEFAULT_TYPE="transmission"
      - CLIENT_DEFAULT_PORT="59859"
      - CLIENT_DEFAULT_NUM_WANT="50"

      - FAKER_DEFAULT_UPLOAD_RATE="700"
      - FAKER_DEFAULT_DOWNLOAD_RATE="0"
      - FAKER_DEFAULT_ANNOUNCE_INTERVAL="1800"
      - FAKER_UPDATE_INTERVAL="5"
    volumes:
      - /your/path/to/data:/data
      # Optional: Uncomment to enable watch folder feature
      # - ${TORRENTS_DIR:-/path/to/your/torrents}:/torrents
    restart: always
    network_mode: service:gluetun
    depends_on:
      gluetun:
        condition: service_healthy

volumes:
  rustatio_data:
