# mise configuration for Rustatio
# https://mise.jdx.dev/

[settings]
lockfile = true

[tools]
# Node.js for UI development
node = "latest"

# Rust toolchain with components
rust = { version = "latest", components = "rustfmt,clippy" }

[env]
CARGO_TERM_COLOR = "always"
RUST_BACKTRACE = "1"

# Project-specific paths
_.path = ["./node_modules/.bin", "./ui/node_modules/.bin"]

[tasks.install-tools]
description = "Install mise tools (Rust + Node)"
run = [
    "echo 'ğŸ“¦ Installing mise tools (Rust + Node)...'",
    "mise install",
    "echo 'âœ… Tools installed!'"
]

[tasks.rust-install]
description = "Install Rust dependencies"
depends = ["install-tools"]
run = [
    "echo 'ğŸ“¦ Installing Rust dependencies...'",
    "cargo fetch",
    "echo 'âœ… Rust dependencies installed!'"
]

[tasks.install]
description = "Install all dependencies (tools + packages)"
depends = ["rust-install", "ui-install"]
run = "echo 'âœ… All dependencies installed!'"

[tasks.run-app]
description = "Build UI and run the application directly"
depends = ["install"]
run = [
    "echo 'ğŸ—ï¸  Building UI...'",
    "cd ui && npm run build",
    "echo 'ğŸš€ Running application...'",
    "cargo run"
]

[tasks.build]
description = "Build for production"
depends = ["rust-install", "ui-build"]
run = [
    "echo 'ğŸ—ï¸  Building Rust backend...'",
    "cargo build --release",
    "echo 'âœ… Build complete!'"
]

[tasks.build-tauri]
description = "Build Tauri application for production"
depends = ["rust-install", "ui-build"]
run = [
    "echo 'ğŸ—ï¸  Building Tauri app...'",
    "cargo tauri build",
    "echo 'âœ… Tauri build complete!'"
]

[tasks.test]
description = "Run all tests"
run = [
    "echo 'ğŸ§ª Running Rust tests...'",
    "cargo test",
    "echo 'âœ… All tests passed!'"
]

[tasks.lint]
description = "Run all linters"
run = [
    "echo 'ğŸ” Linting Rust code...'",
    "cargo clippy --all-targets --all-features -- -D warnings",
    "echo 'ğŸ” Linting UI code...'",
    "cd ui && npm run lint",
    "echo 'âœ… All linting passed!'"
]

[tasks.format]
description = "Format all code"
run = [
    "echo 'ğŸ’… Formatting Rust code...'",
    "cargo fmt",
    "echo 'ğŸ’… Formatting UI code...'",
    "cd ui && npm run format",
    "echo 'âœ… All code formatted!'"
]

[tasks.format-check]
description = "Check code formatting without modifying"
run = [
    "echo 'ğŸ” Checking Rust formatting...'",
    "cargo fmt --check",
    "echo 'ğŸ” Checking UI formatting...'",
    "cd ui && npm run format:check",
    "echo 'âœ… Format check complete!'"
]

[tasks.check]
description = "Run all checks (format, lint, test)"
depends = ["format-check", "lint", "test"]
run = "echo 'âœ… All checks passed!'"

[tasks.clean]
description = "Clean build artifacts"
run = [
    "echo 'ğŸ§¹ Cleaning Rust build artifacts...'",
    "cargo clean",
    "echo 'ğŸ§¹ Cleaning UI build artifacts...'",
    "rm -rf ui/dist ui/node_modules/.vite",
    "echo 'âœ… Clean complete!'"
]

[tasks.clean-all]
description = "Clean all build artifacts and dependencies"
run = [
    "echo 'ğŸ§¹ Cleaning all artifacts and dependencies...'",
    "cargo clean",
    "rm -rf ui/dist ui/node_modules",
    "echo 'âœ… Deep clean complete!'"
]

[tasks.update]
description = "Update all dependencies"
run = [
    "echo 'ğŸ“¦ Updating Rust dependencies...'",
    "cargo update",
    "echo 'ğŸ“¦ Updating UI dependencies...'",
    "cd ui && npm update",
    "echo 'âœ… Dependencies updated!'"
]

[tasks.audit]
description = "Audit dependencies for security vulnerabilities"
run = [
    "echo 'ğŸ”’ Auditing Rust dependencies...'",
    "cargo audit || echo 'Install cargo-audit: cargo install cargo-audit'",
    "echo 'ğŸ”’ Auditing UI dependencies...'",
    "cd ui && npm audit",
    "echo 'âœ… Audit complete!'"
]

[tasks.ci-install]
description = "CI step: install dependencies"
depends = ["rust-install"]
run = [
    "echo 'ğŸ“¦ Installing UI dependencies...'",
    "cd ui && npm ci",
    "echo 'âœ… UI dependencies installed!'"
]

[tasks.ci-build]
description = "CI step: build UI"
depends = ["ci-install"]
run = [
    "echo 'ğŸ—ï¸  Building UI...'",
    "cd ui && npm run build",
    "echo 'âœ… UI built!'"
]

[tasks.ci-format]
description = "CI step: format check"
depends = ["ci-build"]
run = [
    "echo 'ğŸ” Checking Rust formatting...'",
    "cargo fmt --check",
    "echo 'ğŸ” Checking UI formatting...'",
    "cd ui && npm run format:check",
    "echo 'âœ… Format check complete!'"
]

[tasks.ci-lint]
description = "CI step: lint"
depends = ["ci-format"]
run = [
    "echo 'ğŸ” Linting Rust code...'",
    "cargo clippy --all-targets --all-features -- -D warnings",
    "echo 'ğŸ” Linting UI code...'",
    "cd ui && npm run lint",
    "echo 'âœ… All linting passed!'"
]

[tasks.ci-test]
description = "CI step: test"
depends = ["ci-lint"]
run = [
    "echo 'ğŸ§ª Running Rust tests...'",
    "cargo test",
    "echo 'âœ… All tests passed!'"
]

[tasks.ci]
description = "Run CI checks (same as GitHub Actions)"
depends = ["ci-test"]
run = "echo 'âœ… CI checks passed!'"

# UI-specific tasks
[tasks.ui-install]
description = "Install UI dependencies only"
run = "cd ui && npm ci"

[tasks.ui-build]
description = "Build UI for production"
depends = ["ui-install"]
run = "cd ui && npm run build"

[tasks.rust-doc]
description = "Generate Rust documentation"
run = "cargo doc --open --no-deps"

# Version management
[tasks.version]
description = "Show current version"
run = "grep '^version' Cargo.toml | head -1"

# Convenience aliases
[tasks.b]
alias = "build"

[tasks.t]
alias = "test"

[tasks.l]
alias = "lint"

[tasks.f]
alias = "format"

[tasks.c]
alias = "check"
